## =============================================================================
## A bouncing ball; ode with event location
## =============================================================================

#-----------------------------
# the model function
#-----------------------------
ballode<- function(t,y,parms) {
  dy1 <- y[2]
  dy2 <- -9.8
  list(c(dy1,dy2))
}

#-----------------------------
# the root and event function
#-----------------------------
# event triggered when the ball hits the ground (height =0)
root <- function(t,y,parms) y[1]

# bouncing - NOTE: y[1] slightly > 0
event <- function(t,y,parms) {
 y[1]<- 1e-18
 y[2]<- -0.9*y[2]
 return(y)
}

#-----------------------------
# initial values and times
#-----------------------------
yini  <- c(height=1e-18,v=20)
times <- seq(0,20,0.01)

#-----------------------------
# solve the model
#-----------------------------
out   <- lsodar(times=times, y=yini, func = ballode, parms=NULL,
  events=list(func = event, root = TRUE), rootfun = root)

#-----------------------------
# display, plot results
#-----------------------------
plot(out,which = "height", type="l",lwd=2, main="bouncing ball", ylab="height")

